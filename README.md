# Practical-Malware-Analysis
Write up for PMA labs solution
## CHAPTER 1
### Lab 1-1
#### Questions
1. Upload the files to http://www.VirusTotal.com/ and view the reports. Does
either file match any existing antivirus signatures?
2. When were these files compiled?
3. Are there any indications that either of these files is packed or obfuscated?
If so, what are these indicators?
4. Do any imports hint at what this malware does? If so, which imports
are they?
5. Are there any other files or host-based indicators that you could look for
on infected systems?
6. What network-based indicators could be used to find this malware on
infected machines?
7. What would you guess is the purpose of these files?
#### Solution
1- These files were written specifically for this book, so as of this writing,
you should not find a signature for them on VirusTotal.com. Of course, if
these files become part of the antivirus signatures as a result of the publi-
cation of this book, the results will be different.

2-Both files were compiled on December 19, 2010, within 1 minute of each other.
![dll](https://github.com/A8N0RMAL/Practical-Malware-Analysis/assets/119806250/0640abd7-1014-4143-bcbd-8c1807e03a88)
![exe01](https://github.com/A8N0RMAL/Practical-Malware-Analysis/assets/119806250/e83893ce-ef66-41fc-bc9f-3f7e8afb34e1)

3- There are no indications that either file is packed or obfuscated, PEiD labels this as unpacked code compiled with Microsoft Visual C++,
which tells us that these files are not packed.
![Unpackeddll](https://github.com/A8N0RMAL/Practical-Malware-Analysis/assets/119806250/c30663f6-43f0-4fb2-96bc-696456578b0d)
![Unpackedexe01](https://github.com/A8N0RMAL/Practical-Malware-Analysis/assets/119806250/2362d06b-7645-4fe6-8f77-d2f9001cfebe)

4- The interesting imports from Lab01-01.exe are FindFirstFile, FindNextFile,
and CopyFile. These imports tell us that the program searches the file-
system and copies files. The most interesting imports from Lab01-01.dll
are CreateProcess and Sleep. We also see that this file imports functions
from WS2_32.dll, which provides network functionality.
![exe01](https://github.com/A8N0RMAL/Practical-Malware-Analysis/assets/119806250/ed8bfaac-8c8c-458c-a3c0-bcdc30a1ed7a)

5- Examine C:\Windows\System32\kerne132.dll for additional malicious activ-
ity. Note that the file kerne132.dll, with the number 1 instead of the letter
l, is meant to look like the system file kernel32.dll. This file can be used as
a host indicator to search for the malware.

6- The .dll file contains a reference to local IP address 127.26.152.13. This
address is an artifact of this program having been created for educational
and not malicious purposes. If this was real malware(and that is :') ), the IP address should
be routable, and it would be a good network-based indicator for use in
identifying this malware.

7- The .dll file is probably a backdoor because it imports functions
from WS2_32.dll, which provides network functionality and we also see two interest-
ing functions imported from kernel32.dll: CreateProcess and Sleep, which are
commonly used as backdoors. These functions are particularly interesting to
us in combination with the strings exec and sleep. The exec string is probably
sent over the network to command the backdoor to run a program with
CreateProcess. The sleep string is probably used to command the backdoor
program to sleep. The .exe file is used to install or run the DLL.
> [!NOTE]
> Hackers use backdoors to communicate with a command-and-control server and bypass security

> [!IMPORTANT]
> Backdoor -> Malicious code that installs itself onto a computer to allow the attacker access. Backdoors usually let the attacker connect to the computer with little or no authentication and execute commands on the local system.

![how_a_backdoor_attack_works-f](https://github.com/A8N0RMAL/Practical-Malware-Analysis/assets/119806250/8ece181f-8d26-452b-bb76-99be989936c0)

---
### Lab 1-2
#### Questions
1. Upload the Lab01-02.exe file to http://www.VirusTotal.com/. Does it match
any existing antivirus definitions?
2. Are there any indications that this file is packed or obfuscated? If so,
what are these indicators? If the file is packed, unpack it if possible.
3. Do any imports hint at this program’s functionality? If so, which imports
are they and what do they tell you?
4. What host- or network-based indicators could be used to identify this
malware on infected machines?
#### Solution
1- The file matches 55 of 70 antivirus signatures.
![Virustotal](https://github.com/A8N0RMAL/Practical-Malware-Analysis/assets/119806250/47419c31-aac3-4979-b189-38096aec5618)

2- Using Exeninfo, Detect it easy and PEiD, we should see that the file is packed with UPX if u have to unpack it download upx and run this command -> upx.exe -d filename.exe
Note : In Normal mode in PEid u see nothing but when u try Deep-Mode u will see that file is packed (:'
![Packed](https://github.com/A8N0RMAL/Practical-Malware-Analysis/assets/119806250/d4fdfb1d-5dc0-4b0a-9266-2d2cf2a6c4bf)
![Deep-ModePEiD](https://github.com/A8N0RMAL/Practical-Malware-Analysis/assets/119806250/9a1b2e1d-d2a4-44ca-b251-8a7d5eeda556)

3- After unpacking, we look at the imports sections and the strings. The
imports from kernel32.dll and msvcrt.dll are imported by nearly every program,
so they tell us little about this specific program. The imports from wininet.dll
tell us that this code connects to the Internet (InternetOpen and InternetOpenURL),
and the import from advapi32.dll (CreateService) tell us that the code creates a
service. When we look at the strings, we see www.malwareanalysisbook.com, which
is probably the URL opened by InternetOpenURL as well as by Malservice, which
could be the name of the service that is created.
![UnpackingFile](https://github.com/A8N0RMAL/Practical-Malware-Analysis/assets/119806250/2128ac78-b00a-41d6-a0f8-e1f969c32a66)
![Strings](https://github.com/A8N0RMAL/Practical-Malware-Analysis/assets/119806250/f8a4bbf9-7ef8-4018-af27-fab8312e06d2)

4- We can’t be sure what this program is doing, but we’ve found some indicators to help search for this malware across a network.

---
### Lab 1-3
#### Questions
1. Upload the Lab01-03.exe file to http://www.VirusTotal.com/. Does it match
any existing antivirus definitions?
2. Are there any indications that this file is packed or obfuscated? If so,
what are these indicators? If the file is packed, unpack it if possible.
3. Do any imports hint at this program’s functionality? If so, which imports
are they and what do they tell you?
4. What host- or network-based indicators could be used to identify this
malware on infected machines?
#### Solution
1- 61 of 71 virus engines identify this sample as malware.
![VirusTotal](https://github.com/A8N0RMAL/Practical-Malware-Analysis/assets/119806250/37599913-63f3-4933-978b-cede707d9120)

2- The file is packed with (FSG 1.0), but we can’t unpack it at this time.
>[!NOTE]
>Not always ur tool will give u the exactly result ,so try using several tools as showen here Exeninfo couldn't recognize that the file is packed but other tools can recognize that.
![PackedFile](https://github.com/A8N0RMAL/Practical-Malware-Analysis/assets/119806250/0a5fea37-a1de-46c5-927b-a3d01eef75c6)

3- This question can’t be answered without unpacking the file.

4- This question can’t be answered without unpacking the file.

---
### Lab 1-4
#### Questions
1. Upload the Lab01-04.exe file to http://www.VirusTotal.com/. Does it match
any existing antivirus definitions?
2. Are there any indications that this file is packed or obfuscated? If so,
what are these indicators? If the file is packed, unpack it if possible.
3. When was this program compiled?
4. Do any imports hint at this program’s functionality? If so, which imports
are they and what do they tell you?
5. What host- or network-based indicators could be used to identify this
malware on infected machines?
6. This file has one resource in the resource section. Use Resource Hacker
to examine that resource, and then use it to extract the resource. What
can you learn from the resource?
#### Solution
1-  59 of 71 antivirus engines identify this as malicious code that downloads and/or drops additional malware onto a system.
![VirusTotal,PNG](https://github.com/A8N0RMAL/Practical-Malware-Analysis/assets/119806250/783b8e9e-21cc-47b2-94f6-bd9b41960466)

2- There are no indications that the file is packed or obfuscated.
![UnpackedFile](https://github.com/A8N0RMAL/Practical-Malware-Analysis/assets/119806250/cb6fd92b-7330-4b08-b60d-4a99d6d4e200)

3- This program was compiled at Fri Aug 30 22:26:59 2019 | UTC, and this compile time is faked.
![CompilingTime](https://github.com/A8N0RMAL/Practical-Malware-Analysis/assets/119806250/6979c6e2-d458-411b-a8ad-536d77feff87)

4- The imports from advapi32.dll indicate that the program is doing something with permissions. The imports from WinExec and WriteFile, along with the results from VirusTotal.com, tell us that the program writes a file to disk and then executes it. There are also imports for reading information from the resource section of the file.
![Imports](https://github.com/A8N0RMAL/Practical-Malware-Analysis/assets/119806250/05901bd5-de42-476a-b87c-88144300b128)

5- The string \system32\wupdmgr.exe indicates that this program could create or modify a file at that location. The string www.malwareanalysisbook.com/updater.exe probably indicates where additional malware is stored, ready for download.
![Strings](https://github.com/A8N0RMAL/Practical-Malware-Analysis/assets/119806250/a9bfa6d1-0671-4824-beda-0bad70d04d27)
![Strings1](https://github.com/A8N0RMAL/Practical-Malware-Analysis/assets/119806250/7d4829ce-ae79-4d45-82f3-61ccfae83ab5)
![Strings2](https://github.com/A8N0RMAL/Practical-Malware-Analysis/assets/119806250/dab6fc9a-f42f-4373-ad93-05736d0b4d43)

6- The resource section contains another PE executable. Use Resource
Hacker to save the resource as binary data, and then analyze the binary
file as you would analyze any executable. The executable in the resource
section is a downloader program that downloads additional malware, because it accesses the network functions. It calls
URLDownloadToFile, a function commonly used by malicious downloaders. It
also calls WinExec, which probably executes the downloaded file.
![BinFile](https://github.com/A8N0RMAL/Practical-Malware-Analysis/assets/119806250/9dbe5bbc-40eb-4f50-8209-652fbdce63e9)

--------------------------------**This concludes CHAPTER 1**--------------------------------

---
## CHAPTER 5
### Lab 5-1
#### Questions
